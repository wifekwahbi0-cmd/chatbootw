<!-- زر فتح الشات -->
<button id="chatbot-toggle" style="position:fixed; bottom:20px; right:20px; padding:10px 15px; background:#2a7483; color:white; border:none; border-radius:50px; cursor:pointer;">مساعد</button>

<!-- نافذة الشات -->
<div id="chatbot-container" style="position:fixed; bottom:20px; right:20px; width:320px; max-height:420px; border:1px solid #ccc; border-radius:10px; display:none; background:#fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
  <div id="chatbot-header" style="padding:10px; background:#2a7483; color:white;">
    مساعد العيادة
    <span id="chatbot-close" style="float:right; cursor:pointer;">×</span>
  </div>
  <div id="chatbot-body" style="padding:10px; overflow-y:auto; height:300px;"></div>
  <div id="chatbot-input-area" style="padding:10px; border-top:1px solid #eee;">
    <input type="text" id="chatbot-input" style="width:75%; padding:5px;" placeholder="اكتب هنا..." />
    <button id="chatbot-send">إرسال</button>
  </div>
</div>

<!-- إضافة مكتبة EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.4.1/dist/email.min.js"></script>
<script>
(function(){
   emailjs.init("cAOT9bLDDF2H4XRng"); // المفتاح العمومي
})();

document.getElementById('chatbot-toggle').onclick = () => {
  document.getElementById('chatbot-container').style.display = 'block';
};
document.getElementById('chatbot-close').onclick = () => {
  document.getElementById('chatbot-container').style.display = 'none';
};

const body = document.getElementById('chatbot-body');
const input = document.getElementById('chatbot-input');

function addMessage(from, text) {
  const msg = document.createElement('div');
  msg.style.margin = '5px 0';
  msg.innerHTML = `<strong>${from}:</strong> ${text}`;
  body.appendChild(msg);
  body.scrollTop = body.scrollHeight;
}

document.getElementById('chatbot-send').onclick = () => {
  const userText = input.value.trim();
  if (!userText) return;
  addMessage('أنت', userText);
  input.value = '';

  if (userText.includes("حجز")) {
    addMessage('مساعد', 'من فضلك أدخل البيانات بهذا الشكل: الاسم - الهاتف - الخدمة - التاريخ');
  } else if (userText.includes("-")) {
    // تقسيم البيانات
    const parts = userText.split("-");
    const data = {
      from_name: parts[0] ? parts[0].trim() : "غير محدد",
      phone: parts[1] ? parts[1].trim() : "غير محدد",
      service: parts[2] ? parts[2].trim() : "غير محدد",
      date: parts[3] ? parts[3].trim() : "غير محدد",
    };
    
    // إرسال البريد عبر EmailJS
    emailjs.send("service_aovg5ql","template_mv4rb3k", data)
    .then(function() {
      addMessage('مساعد', '✅ تم إرسال طلبك إلى العيادة، سنتصل بك لتأكيد الموعد.');
    }, function(error) {
      addMessage('مساعد', '⚠️ حدث خطأ أثناء الإرسال. حاول مرة أخرى.');
      console.error("EmailJS Error:", error);
    });
  } else {
    addMessage('مساعد', 'يمكنني مساعدتك في الحجز أو إعطاؤك معلومات عن العيادة. اكتب "حجز" للبدء.');
  }
};
</script>
